@echo off
setlocal EnableDelayedExpansion

set "font_zip_url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/Fonts.zip"
set "font_folder=C:\Windows\Fonts"
set "temp_folder=%TEMP%\Fonts"

rem Create temporary folder to extract the font ZIP file
md "%temp_folder%"

rem Download the font ZIP file
powershell -command "& { Invoke-WebRequest '%font_zip_url%' -OutFile '%temp_folder%\Fonts.zip' }"

rem Extract the font files from the ZIP archive
powershell -command "& { Expand-Archive '%temp_folder%\Fonts.zip' -DestinationPath '%temp_folder%' }"

rem Install the font files
for %%f in ("%temp_folder%\*.ttf" "%temp_folder%\*.otf") do (
    echo Installing font: %%~nxf
    if exist "%font_folder%\%%~nxf" (
        del /f "%font_folder%\%%~nxf"
    )
    copy "%%~f" "%font_folder%"
)

rem Reload the font cache
powershell -command "& { [System.Runtime.InteropServices.Marshal]::ReleaseComObject([System.__ComObject].CreateObject(\"Shell.Application\")).NameSpace(0x0014).Items().InvokeVerb(\"FontReg\") }"

rem Clean up by deleting the extracted font files and ZIP archive
rd /s /q "%temp_folder%"
del /f "%temp_folder%\Fonts.zip"


rem Installing Chrome and Teams

echo Installing Google Chrome...
curl https://dl.google.com/chrome/install/standalone/GoogleChromeStandaloneEnterprise64.msi -o GoogleChromeStandaloneEnterprise64.msi
msiexec /i GoogleChromeStandaloneEnterprise64.msi /quiet /qn /norestart
del GoogleChromeStandaloneEnterprise64.msi

echo Installing Microsoft Teams...
curl https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&arch=x64&download=true -o Teams.exe
Teams.exe --silent
del Teams.exe

echo Installation complete.



rem Installing Display drivers

set DOWNLOAD_URL=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/DisplayLink.USB.Graphics.Software.for.Windows11.0.M0-EXE.exe
set INSTALLER_NAME=DisplayLink.USB.Graphics.Software.for.Windows11.0.M0-EXE.exe

echo Downloading DisplayLink driver installer from %DOWNLOAD_URL%...
bitsadmin /transfer "DisplayLinkInstaller" %DOWNLOAD_URL% %INSTALLER_NAME%

echo Installing DisplayLink driver...
start /wait %INSTALLER_NAME% /silent

echo DisplayLink driver installation completed.



rem Installs printer


setlocal

rem Define variables
set "url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/upd-pcl6-x64-6.9.0.24630.exe"
set "filename=upd-pcl6-x64-6.9.0.24630.exe"

rem Download the installer
echo Downloading printer installer...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%url%', '%filename%')"

rem Start the installer and let the user choose the options
echo Starting printer installer...
start "" /wait "%filename%"

rem Cleanup
echo Cleaning up...
del "%filename%"

echo Done.
pause
