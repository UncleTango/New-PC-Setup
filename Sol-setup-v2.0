@echo off

setlocal


rem Define varibels Display drivers

set DOWNLOAD_URL=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/DisplayLink.USB.Graphics.Software.for.Windows11.0.M0-EXE.exe
set INSTALLER_NAME=DisplayLink.USB.Graphics.Software.for.Windows11.0.M0-EXE.exe


rem Define variables printer
set "url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/upd-pcl6-x64-6.9.0.24630.exe"
set "filename=upd-pcl6-x64-6.9.0.24630.exe"





set "font_zip_url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/Fonts.zip"
set "font_folder=C:\Windows\Fonts"
set "temp_folder=%TEMP%\Fonts"

echo Downloading font ZIP file from %font_zip_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%font_zip_url%', '%temp_folder%\Fonts.zip')"

echo Extracting font files from ZIP archive...
powershell -Command "Expand-Archive -Path '%temp_folder%\Fonts.zip' -DestinationPath '%temp_folder%'"

echo Installing font files...
for %%F in ("%temp_folder%\*.ttf" "%temp_folder%\*.otf") do (
    echo Installing %%~nxF...
    if exist "%font_folder%\%%~nxF" (
        echo Removing existing copy of %%~nxF...
        del "%font_folder%\%%~nxF" /f /q
    )
    copy "%%~F" "%font_folder%\"
)

echo Reloading font cache...
powershell -Command "[System.Runtime.InteropServices.Marshal]::ReleaseComObject([System.__ComObject]$shellApp).SHChangeNotify(0x1ffffff, 0x1000, $null, $null)"

echo Cleaning up...
rd /s /q "%temp_folder%"
del "%temp_folder%\Fonts.zip"


rem Installing Chrome and Teams

echo Installing Google Chrome...
curl https://dl.google.com/chrome/install/standalone/GoogleChromeStandaloneEnterprise64.msi -o GoogleChromeStandaloneEnterprise64.msi
msiexec /i GoogleChromeStandaloneEnterprise64.msi /quiet /qn /norestart
del GoogleChromeStandaloneEnterprise64.msi

echo Installing Microsoft Teams...
curl https://teams.microsoft.com/downloads/desktopurl?env=production&plat=windows&arch=x64&download=true -o Teams.exe
Teams.exe --silent
del Teams.exe

echo Installation complete.



rem Installing Display drivers

echo Downloading DisplayLink driver installer from %DOWNLOAD_URL%...
bitsadmin /transfer "DisplayLinkInstaller" %DOWNLOAD_URL% %INSTALLER_NAME%

echo Installing DisplayLink driver...
start /wait %INSTALLER_NAME% /silent

echo DisplayLink driver installation completed.



rem Installs printer


setlocal


rem Download the installer
echo Downloading printer installer...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%url%', '%filename%')"

rem Start the installer and let the user choose the options
echo Starting printer installer...
start "" /wait "%filename%"

rem Cleanup
echo Cleaning up...
del "%filename%"

echo Done.
pause
