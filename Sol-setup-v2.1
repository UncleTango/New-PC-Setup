@echo off

:: Step 1: Download and install fonts from ZIP file
set "font_zip_url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/Fonts.zip"
set "font_folder=C:\Windows\Fonts"
set "temp_folder=%TEMP%\Fonts"

echo Downloading font ZIP file from %font_zip_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%font_zip_url%', '%temp_folder%\Fonts.zip')"

echo Extracting font files from ZIP archive...
powershell -Command "Expand-Archive -Path '%temp_folder%\Fonts.zip' -DestinationPath '%temp_folder%'"

echo Installing font files...
for %%F in ("%temp_folder%\*.ttf" "%temp_folder%\*.otf") do (
    echo Installing %%~nxF...
    if exist "%font_folder%\%%~nxF" (
        echo Removing existing copy of %%~nxF...
        del "%font_folder%\%%~nxF" /f /q
    )
    copy "%%~F" "%font_folder%\"
)

echo Reloading font cache...
powershell -Command "[System.Runtime.InteropServices.Marshal]::ReleaseComObject([System.__ComObject]$shellApp).SHChangeNotify(0x1ffffff, 0x1000, $null, $null)"

echo Cleaning up...
rd /s /q "%temp_folder%"
del "%temp_folder%\Fonts.zip"

:: Step 2: Download and install Chrome and Teams
set "chrome_url=https://dl.google.com/chrome/install/standalone/GoogleChromeStandaloneEnterprise64.msi"
set "teams_url=https://go.microsoft.com/fwlink/p/?LinkID=869428&clcid=0x409&culture=en-us&country=us"
set "temp_folder=%TEMP%"

echo Downloading Chrome installer from %chrome_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%chrome_url%', '%temp_folder%\Chrome.msi')"

echo Installing Chrome...
msiexec /i "%temp_folder%\Chrome.msi" /qn

echo Downloading Teams installer from %teams_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%teams_url%', '%temp_folder%\Teams.exe')"

echo Installing Teams...
"%temp_folder%\Teams.exe" --silent

:: Step 3: Download and install DisplayLink drivers
set "displaylink_url=https://github.com/UncleTango/New-PC-Setup/releases/download/v1.0/DisplayLink.USB.Graphics.Software.for.Windows11.0.M0-EXE.exe"
set "temp_folder=%TEMP%"

echo Downloading DisplayLink drivers from %displaylink_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%displaylink_url%', '%temp_folder%\DisplayLink.exe')"

echo Installing DisplayLink drivers...
"%temp_folder%\DisplayLink.exe" /silent /norestart

:: Step 4: Download printer program and prompt user for installation options
set "printer_url=https://download.brother.com/welcome/dlf006347/DCCP-J110DW-inst-B1-usa.EXE"
set "temp_folder=%TEMP%"

echo Downloading printer program from %printer_url%...
powershell -Command "(New-Object Net.WebClient).DownloadFile('%printer_url%', '%temp_folder%\Printer.exe')"

echo Installing printer program...
"%temp_folder%\Printer.exe"

echo Done.
